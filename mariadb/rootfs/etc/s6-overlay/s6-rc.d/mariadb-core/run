#!/command/with-contenv bashio
# shellcheck shell=bash
# ==============================================================================
# Start MariaDB service
# ==============================================================================

# Initialize an empty string to hold the concatenated parameters
param_string=""

# Init params
for param in $(bashio::config "parameters"); do
    bashio::log.info "$param"
    PARAM=$(bashio::config "parameters[${right}].key")
    VALUE=$(bashio::config "parameters[${right}].value")
    bashio::log.info "Configured ${PARAM}: ${VALUE}"
    param_string+="--${PARAM}=${VALUE} "
done

# Trim the trailing space (optional)
param_string=$(echo "$param_string" | sed 's/ *$//')

# Print the concatenated string of parameters
bashio::log.info "Concatenated parameters: $param_string"


# Start mariadb
bashio::log.info "Starting MariaDB"
mkdir -p /run/mysqld
exec mysqld --datadir="${MARIADB_DATA}" --user=root "${param_string}" < /dev/null
